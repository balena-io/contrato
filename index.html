<!DOCTYPE html><html class="default" lang="en" data-base="."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@balena/contrato</title><meta name="description" content="Documentation for @balena/contrato"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@balena/contrato</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@balena/contrato</h1></div><div class="tsd-panel tsd-typography"><a id="contrato" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Contrato<a href="#contrato" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The official <a href="#about-contracts">contracts</a> implementation</p>
<a id="quickstart" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Quickstart<a href="#quickstart" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Contract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">osContract</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.os&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;balenaos&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;6.1.2&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">children:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.service&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;balena-engine&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;20.10.43&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">		{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.service&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;NetworkManager&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;0.6.0&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">	</span><span class="hl-2">provides:</span><span class="hl-1"> [{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.feature&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;secureboot&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">serviceContract</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.application&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;myapp&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">requires:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.service&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;balena-engine&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;&gt;20&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">		{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.feature&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;secureboot&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">osContract</span><span class="hl-1">.</span><span class="hl-6">satisfiesChildContract</span><span class="hl-1">(</span><span class="hl-2">serviceContract</span><span class="hl-1">)) {</span><br/><span class="hl-1">	</span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;myapp can be installed!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><a href="https://balena-io.github.io/contrato/index.html"><img src="https://github.com/balena-io/contrato/actions/workflows/docs.yml/badge.svg" alt="API Documentation"></a></p>
<a id="about-contracts" class="tsd-anchor"></a><h2 class="tsd-anchor-link">About contracts<a href="#about-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contracts provide a standardized mechanism to describing <em>things</em>. A thing generally refers to something versionable, e.g. a software library, a feature, an API, etc. Relationships between things can be established via composition and referencing (<code>requires</code> and <code>provides</code>). Through this library, contracts can be validated, composed and combined.</p>
<a id="why-build-this" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Why build this?<a href="#why-build-this" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="http://balena.io">balena.io</a> is a complex product with a great number of inter-conecting components. Each of the components have their own requisites, capabilities, and incompatibilities. Contracts are an effort to formally document those interfaces, and a foundation on which we can build advanced tooling to ultimately automate the process of the team, increase productivity, and remove the human element from tasks that can be performed better by a machine.</p>
<p>The concept of contracts is generic enough that it can be applied to seemingly unrelated scenarios, from base images and OS images, to device types and backend components. Re-using the same contract syntax between them allows us to multiply the gains we get by developing complex contract-related programming modules.</p>
<a id="what-can-be-done-with-contracts" class="tsd-anchor"></a><h3 class="tsd-anchor-link">What can be done with contracts?<a href="#what-can-be-done-with-contracts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Describe a <em>thing</em></p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.library&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;glibc&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;2.40&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;assets&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;license&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GNU Lesser General Public License&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;https://www.gnu.org/licenses/lgpl-3.0.html#license-text&quot;</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Describe a <em>thing</em> that requires a <em>thing</em></p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.utility&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;curl&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;8.11.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;requires&quot;</span><span class="hl-1">: [{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.library&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;glibc&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;&gt;=2.17&quot;</span><span class="hl-1"> }],</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;data&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;protocols&quot;</span><span class="hl-1">: [</span><span class="hl-3">&quot;HTTP&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;HTTPS&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;FTP&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Describe a complex <em>thing</em> via a composite contract</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.os&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;balenaos&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;4.1.5&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;children&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.library&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;glibc&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;2.16&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;assets&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">				</span><span class="hl-7">&quot;license&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">					</span><span class="hl-7">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;GNU Lesser General Public License&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">					</span><span class="hl-7">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;https://www.gnu.org/licenses/lgpl-3.0.html#license-text&quot;</span><br/><span class="hl-1">				}</span><br/><span class="hl-1">			}</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Describe a set of things via <a href="#contract-templating">templating</a></p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;alpine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.os&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;data&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;libc&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;musl-libc&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;latest&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;3.20&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;versionList&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;`3.20 (latest)`, `3.19`&quot;</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;Alpine Linux {{this.version}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;requires&quot;</span><span class="hl-1">: [{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.blob&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;balena-idle&quot;</span><span class="hl-1"> }],</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;variants&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;requires&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">				{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;sw.blob&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;qemu&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">				{</span><br/><span class="hl-1">					</span><span class="hl-7">&quot;or&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">						{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;arch.sw&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;armv7hf&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">						{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;arch.sw&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;rpi&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">						{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;arch.sw&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;aarch64&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">					]</span><br/><span class="hl-1">				}</span><br/><span class="hl-1">			],</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;variants&quot;</span><span class="hl-1">: [{ </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;3.19&quot;</span><span class="hl-1"> }, { </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;3.20&quot;</span><span class="hl-1"> }]</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;requires&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">				{</span><br/><span class="hl-1">					</span><span class="hl-7">&quot;or&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">						{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;arch.sw&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;i386&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">						{ </span><span class="hl-7">&quot;type&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;arch.sw&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;amd64&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">					]</span><br/><span class="hl-1">				}</span><br/><span class="hl-1">			],</span><br/><span class="hl-1">			</span><span class="hl-7">&quot;variants&quot;</span><span class="hl-1">: [{ </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;3.19&quot;</span><span class="hl-1"> }, { </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;3.20&quot;</span><span class="hl-1"> }]</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="additional-information" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Additional information<a href="#additional-information" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>See the <a href="media/balena-contracts.md">contracts specification</a> for additional documentation on the contract format.</p>
<a id="about-contrato" class="tsd-anchor"></a><h2 class="tsd-anchor-link">About contrato<a href="#about-contrato" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contrato is the Balena contracts implementation. It provides capabilities for searching, comparing, validating and cross referencing contracts, as well as generating combinations of the contracts from a given context (via <a href="#blueprints">blueprints</a>) and using these combinations to build templates. Some additional description about these features is provided below.</p>
<a id="contract-validation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Contract validation<a href="#contract-validation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A contract is valid within a context if all requirements of the contract and its children are met in the given context. A requirement is met if there is a contract within the context (including children) that matches the requirement. For example</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Contract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">assert</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;assert&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">osContract</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.os&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;balenaos&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;4.1.5&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-2">children:</span><span class="hl-1"> [</span><br/><span class="hl-1">		{</span><br/><span class="hl-1">			</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.library&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;glibc&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;2.16&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">		},</span><br/><span class="hl-1">	],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// This is true</span><br/><span class="hl-6">assert</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">osContract</span><span class="hl-1">.</span><span class="hl-6">satisfiesChildContract</span><span class="hl-1">(</span><br/><span class="hl-1">		</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">			</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.utility&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;myapp&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;8.11.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">requires:</span><span class="hl-1"> [{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.library&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;glibc&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;&gt;=2.15&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">		}),</span><br/><span class="hl-1">	),</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// This is false</span><br/><span class="hl-6">assert</span><span class="hl-1">(</span><br/><span class="hl-1">	!</span><span class="hl-2">osContract</span><span class="hl-1">.</span><span class="hl-6">satisfiesChildContract</span><span class="hl-1">(</span><br/><span class="hl-1">		</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">			</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.utility&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;myapp&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;8.11.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">requires:</span><span class="hl-1"> [{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.library&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;glibc&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;&lt;2&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">		}),</span><br/><span class="hl-1">	),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Contrato also allows to find unsatisfied requirements, e.g.</p>
<pre><code class="ts"><span class="hl-8">// Will print [{ type: &#39;sw.library&#39;, slug: &#39;glibc&#39;, version: &#39;&gt;=2.17&#39; }]</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">osContract</span><span class="hl-1">.</span><span class="hl-6">getNotSatisfiedChildRequirements</span><span class="hl-1">(</span><br/><span class="hl-1">		</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Contract</span><span class="hl-1">({</span><br/><span class="hl-1">			</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.utility&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;curl&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;8.11.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-2">requires:</span><span class="hl-1"> [{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.library&#39;</span><span class="hl-1">, </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;glibc&#39;</span><span class="hl-1">, </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&#39;&gt;=2.17&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">		}),</span><br/><span class="hl-1">	),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="contract-templating" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Contract templating<a href="#contract-templating" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>String properties of contracts may reference other number or string properties declared on the same contract by using the <code>this</code> keyword along with handlebars notation.</p>
<p>For example</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;slug&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;mycontract&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;1.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;This is my contract&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;aliases&quot;</span><span class="hl-1">: [</span><span class="hl-3">&quot;my_contract&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;data&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;number&quot;</span><span class="hl-1">: </span><span class="hl-9">5</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-7">&quot;assets&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-7">&quot;file&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;https://files.contracts.io/{{this.slug}}/{{this.componentVersion}}/{{this.data.number}}.data&quot;</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>A single template can be used to generate multiple contracts using the <code>variants</code> property on the Contract specification. A good example of this is in the <a href="https://github.com/balena-io/contracts/blob/master/contracts/sw.os/alpine/contract.json">Alpine OS contract template</a> describes the combination of different architecture builds for a list of versions and can be compiled into a set of contracts. See also the <a href="https://github.com/balena-io/contracts/blob/master/contracts/sw.stack/node/contract.json">NodeJS contract</a> for a more complex example.</p>
<p>In Contrato, the template can be compiled into concrete contracts using the <a href="https://balena-io.github.io/contrato/classes/Contract.html#build">Contract.build</a> function.</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Contract</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Build the template into the resulting contracts</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">contracts</span><span class="hl-1"> = </span><span class="hl-2">Contract</span><span class="hl-1">.</span><span class="hl-6">build</span><span class="hl-1">({ </span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;mycontract&#39;</span><span class="hl-1"> </span><span class="hl-8">/* ... */</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<a id="universes" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Universes<a href="#universes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A universe is a composite contract that conforms the collection of &quot;things&quot; being operated on. For instance, the set of contracts on <a href="https://github.com/balena-io/contracts">balena-io/contracts</a> compose the universe of Balena's contracts containing the knowledge about device types, architectures, OS versions and software stacks available to Balena and its products.</p>
<p>Contrato provides the <a href="https://balena-io.github.io/contrato/classes/Universe.html">Universe type</a> for working with a universe of contracts.</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Contract</span><span class="hl-1">, </span><span class="hl-2">Universe</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Load the universe of contracts from ./contracts</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">universe</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">Universe</span><span class="hl-1">.</span><span class="hl-6">fromFs</span><span class="hl-1">(</span><span class="hl-3">&#39;./contracts&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Find all contracts for the Debian OS</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">children</span><span class="hl-1"> = </span><span class="hl-2">universe</span><span class="hl-1">.</span><span class="hl-6">findChildren</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-2">Contract</span><span class="hl-1">.</span><span class="hl-6">createMatcher</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;sw.os&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-2">slug:</span><span class="hl-1"> </span><span class="hl-3">&#39;debian&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	}),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="blueprints" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Blueprints<a href="#blueprints" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A blueprint is a contract that defines how to generate a certain combination of contracts from a universe. The result of &quot;applying&quot; a blueprint on a universe is a set of contexts. A <em>context</em> is a universe where all requirements are satisfied.</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Universe</span><span class="hl-1">, </span><span class="hl-2">Blueprint</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Load the universe of contracts from balena-io/contracts</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">universe</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">Universe</span><span class="hl-1">.</span><span class="hl-6">fromFs</span><span class="hl-1">(</span><span class="hl-3">&#39;./contracts&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Create a blueprint</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">blueprint</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Blueprint</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-8">// specify a layout combining one instance of device-type, arch and os contracts</span><br/><span class="hl-1">	{ </span><span class="hl-3">&#39;hw.device-type&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">, </span><span class="hl-3">&#39;arch.sw&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">, </span><span class="hl-3">&#39;sw.os&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1"> },</span><br/><span class="hl-1">	</span><span class="hl-8">// use this skeleton as the parent contract for each context</span><br/><span class="hl-1">	{ </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;meta.context&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// Reproduce the blueprint over the universe</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">contexts</span><span class="hl-1"> = </span><span class="hl-2">blueprint</span><span class="hl-1">.</span><span class="hl-6">reproduce</span><span class="hl-1">(</span><span class="hl-2">universe</span><span class="hl-1">);</span><br/><br/><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">contexts</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-8">// Do something with each context, e.g. build a template</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="templates" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Templates<a href="#templates" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A contract (usually a context) can be combined with a template contract in order to produce a resulting text artifact based on template <a href="#partials">Partials</a>. Templates are rendered using the <a href="https://handlebarsjs.com">handlebars templating language</a>.</p>
<p>Example: generate OS install instructions from a context.</p>
<pre><code><span class="hl-9">1.</span><span class="hl-1"> {{</span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">download</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">&quot;}}</span><br/><br/><span class="hl-9">2.</span><span class="hl-1"> {{</span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">download</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">sw</span><span class="hl-1">.</span><span class="hl-2">image</span><span class="hl-1">-</span><span class="hl-2">writer</span><span class="hl-1">&quot;}}. {{</span><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">flash</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">sw</span><span class="hl-1">.</span><span class="hl-2">image</span><span class="hl-1">-</span><span class="hl-2">writer</span><span class="hl-1">+</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}.</span><br/><br/><span class="hl-9">3.</span><span class="hl-1"> {{</span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">insert</span><span class="hl-1">-</span><span class="hl-2">install</span><span class="hl-1">-</span><span class="hl-2">media</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}. {{</span><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">prepare</span><span class="hl-1">-</span><span class="hl-2">network</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}. {{</span><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">boot</span><span class="hl-1">-</span><span class="hl-2">external</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}</span><br/><br/><span class="hl-1">{{#</span><span class="hl-2">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">.</span><span class="hl-2">storage</span><span class="hl-1">.</span><span class="hl-2">internal</span><span class="hl-1">}}</span><br/><span class="hl-9">4.</span><span class="hl-1"> </span><span class="hl-2">The</span><span class="hl-1"> </span><span class="hl-2">device</span><span class="hl-1"> </span><span class="hl-2">should</span><span class="hl-1"> </span><span class="hl-2">appear</span><span class="hl-1"> </span><span class="hl-2">on</span><span class="hl-1"> </span><span class="hl-2">you</span><span class="hl-1"> </span><span class="hl-2">dashboard</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> </span><span class="hl-2">configuring</span><span class="hl-1"> </span><span class="hl-2">state</span><span class="hl-1">. {{</span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">description</span><span class="hl-1">-</span><span class="hl-2">of</span><span class="hl-1">-</span><span class="hl-2">internal</span><span class="hl-1">-</span><span class="hl-2">process</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">sw</span><span class="hl-1">.</span><span class="hl-2">image</span><span class="hl-1">-</span><span class="hl-2">writer</span><span class="hl-1">&quot;}}. {{</span><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">visual</span><span class="hl-1">-</span><span class="hl-2">appearance</span><span class="hl-1">-</span><span class="hl-2">when</span><span class="hl-1">-</span><span class="hl-2">off</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}</span><br/><br/><span class="hl-9">5.</span><span class="hl-1"> {{</span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">remove</span><span class="hl-1">-</span><span class="hl-2">install</span><span class="hl-1">-</span><span class="hl-2">media</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}. {{</span><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-2">partial</span><span class="hl-1">=&quot;</span><span class="hl-2">boot</span><span class="hl-1">-</span><span class="hl-2">internal</span><span class="hl-1">&quot; </span><span class="hl-2">combination</span><span class="hl-1">=&quot;</span><span class="hl-10">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">&quot;}}</span><br/><span class="hl-1">{{/</span><span class="hl-2">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">.</span><span class="hl-2">storage</span><span class="hl-1">.</span><span class="hl-2">internal</span><span class="hl-1">}}</span><br/><br/><span class="hl-9">6.</span><span class="hl-1"> </span><span class="hl-2">Your</span><span class="hl-1"> </span><span class="hl-2">device</span><span class="hl-1"> </span><span class="hl-2">should</span><span class="hl-1"> </span><span class="hl-2">appear</span><span class="hl-1"> </span><span class="hl-2">here</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-5">IDLE</span><span class="hl-1"> </span><span class="hl-2">state</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-9">30</span><span class="hl-1"> </span><span class="hl-2">seconds</span><span class="hl-1"> </span><span class="hl-2">or</span><span class="hl-1"> </span><span class="hl-2">so</span><span class="hl-1">. </span><span class="hl-2">Have</span><span class="hl-1"> </span><span class="hl-2">fun</span><span class="hl-1">!</span><br/><br/><span class="hl-1">**</span><span class="hl-11">Troubleshooting</span><span class="hl-1">:** </span><span class="hl-2">If</span><span class="hl-1">, </span><span class="hl-2">upon</span><span class="hl-1"> </span><span class="hl-2">boot</span><span class="hl-1">, </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">device</span><span class="hl-1"> </span><span class="hl-5">LED</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">blinking</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-2">groups</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">four</span><span class="hl-1">, </span><span class="hl-2">it</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">an</span><span class="hl-1"> </span><span class="hl-2">indication</span><span class="hl-1"> </span><span class="hl-2">that</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">device</span><span class="hl-1"> </span><span class="hl-2">cannot</span><span class="hl-1"> </span><span class="hl-2">connect</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">internet</span><span class="hl-1">. </span><span class="hl-2">Please</span><span class="hl-1"> </span><span class="hl-2">ensure</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">network</span><span class="hl-1"> </span><span class="hl-2">adapter</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">functional</span><span class="hl-1">.</span><br/><br/><span class="hl-1">{{#</span><span class="hl-2">compare</span><span class="hl-1"> </span><span class="hl-2">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">.</span><span class="hl-2">media</span><span class="hl-1">.</span><span class="hl-2">installation</span><span class="hl-1"> </span><span class="hl-3">&quot;!==&quot;</span><span class="hl-1"> </span><span class="hl-3">&quot;dfu&quot;</span><span class="hl-1">}}</span><br/><span class="hl-1">**</span><span class="hl-2">Pro</span><span class="hl-1"> </span><span class="hl-11">tip</span><span class="hl-1">:** </span><span class="hl-2">You</span><span class="hl-1"> </span><span class="hl-2">can</span><span class="hl-1"> </span><span class="hl-2">repeat</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">initialisation</span><span class="hl-1"> </span><span class="hl-2">steps</span><span class="hl-1"> </span><span class="hl-2">for</span><span class="hl-1"> </span><span class="hl-2">any</span><span class="hl-1"> </span><span class="hl-2">amount</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> {{</span><span class="hl-2">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">.</span><span class="hl-2">name</span><span class="hl-1">}}</span><span class="hl-3">&#39;s you have available, using the same {{hw.device-type.media.installation}}</span><span class="hl-12">.</span><br/><span class="hl-1">{{/</span><span class="hl-2">compare</span><span class="hl-1">}}</span>
</code><button>Copy</button></pre>

<p>Contracts can be rendered with contrato using the <a href="https://balena-io.github.io/contrato/functions/buildTemplate.html">buildTemplate</a> function</p>
<pre><code class="ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">buildTemplate</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contrato&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">promises</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Reproduce the blueprint over the universe</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">contexts</span><span class="hl-1"> = </span><span class="hl-2">blueprint</span><span class="hl-1">.</span><span class="hl-6">reproduce</span><span class="hl-1">(</span><span class="hl-2">universe</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">template</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-6">readFile</span><span class="hl-1">(</span><span class="hl-3">&#39;instructions.tpl&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;utf8&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">contexts</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">buildTemplate</span><span class="hl-1">(</span><span class="hl-2">template</span><span class="hl-1">, </span><span class="hl-2">context</span><span class="hl-1">));</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="partials" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Partials<a href="#partials" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each contract or combination of contracts may have partials associated with it that may be assembled into text artifacts with the template system.</p>
<p>The convention is to have a directory of contracts with the following structure:</p>
<pre><code><span class="hl-1">&lt;</span><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/&lt;</span><span class="hl-10">slug</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/contract.json</span><br/><span class="hl-1">&lt;</span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/&lt;</span><span class="hl-10">slug</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/partial1.tpl</span><br/><span class="hl-1">&lt;</span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/&lt;</span><span class="hl-10">slug</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/partial2.tpl</span><br/><span class="hl-1">&lt;</span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/&lt;</span><span class="hl-10">slug</span><span class="hl-1"> </span><span class="hl-10">combinations</span><span class="hl-1">&gt;/partialN.tpl</span>
</code><button>Copy</button></pre>

<p>The types and slugs fragments of the path might be one entity, or a set of entities separated by a + sign. For example:</p>
<pre><code><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/</span><span class="hl-2">debian</span><span class="hl-1">+</span><span class="hl-2">amd64</span><span class="hl-1">/</span><span class="hl-2">installation</span><span class="hl-1">.</span><span class="hl-2">tpl</span><br/><span class="hl-2">hw</span><span class="hl-1">.</span><span class="hl-2">device</span><span class="hl-1">-</span><span class="hl-2">type</span><span class="hl-1">/</span><span class="hl-2">ts4900</span><span class="hl-1">/</span><span class="hl-2">remove</span><span class="hl-1">-</span><span class="hl-2">install</span><span class="hl-1">-</span><span class="hl-2">media</span><span class="hl-1">.</span><span class="hl-2">tpl</span>
</code><button>Copy</button></pre>

<p>The type combination section specifies the types of contracts that come into play for a particular partials subtree, separated by a <code>+</code> symbol. If the combination is <code>sw.os+arch.sw</code>, then it means that the subtree will take into account the combination of operating systems and architectures. Note that there can be combinations of a single type.</p>
<p>The slug combination section defines a subtree for a specific set of contracts that match the combination type. If the type combination is <code>sw.os+arch.sw</code>, a valid slug combination can be <code>debian+amd64</code>, which is the subtree that will be selected when matching the Debian GNU/Linux contract with the amd64 architecture contract.</p>
<p>Note that a slug combination may use <code>@</code> symbols to define subtrees for a specific version of one or more contracts in the combination. For example, <code>debian@wheezy+amd64</code> will be the subtree containing partials for the combination of Debian Wheezy and amd64.</p>
<p>You can also omit trailing portions of the slug combination to implement wildcards. If the type combination is <code>sw.os+arch.sw</code> and the slug combination is <code>debian</code>, it means that such subtree will apply to the combination of Debian GNU/Linux with any architecture.</p>
<p>The partial tree is then traversed from specific to general, until a match is found. This is the path that the contract system will follow when searching for the <code>download</code> template on the <code>sw.os+arch.sw</code> combination:</p>
<pre><code><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/&lt;</span><span class="hl-2">os</span><span class="hl-1">&gt;@&lt;</span><span class="hl-2">version</span><span class="hl-1">&gt;+&lt;</span><span class="hl-10">arch</span><span class="hl-1">&gt;@&lt;</span><span class="hl-2">version</span><span class="hl-1">&gt;/</span><span class="hl-2">download</span><span class="hl-1">.</span><span class="hl-2">tpl</span><br/><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/&lt;</span><span class="hl-2">os</span><span class="hl-1">&gt;@&lt;</span><span class="hl-2">version</span><span class="hl-1">&gt;+&lt;</span><span class="hl-10">arch</span><span class="hl-1">&gt;/</span><span class="hl-2">download</span><span class="hl-1">.</span><span class="hl-2">tpl</span><br/><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/&lt;</span><span class="hl-2">os</span><span class="hl-1">&gt;+&lt;</span><span class="hl-10">arch</span><span class="hl-1">&gt;@&lt;</span><span class="hl-2">version</span><span class="hl-1">&gt;/</span><span class="hl-2">download</span><span class="hl-1">.</span><span class="hl-2">tpl</span><br/><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/&lt;</span><span class="hl-2">os</span><span class="hl-1">&gt;+&lt;</span><span class="hl-10">arch</span><span class="hl-1">&gt;/</span><span class="hl-2">download</span><span class="hl-1">.</span><span class="hl-2">tpl</span><br/><span class="hl-2">sw</span><span class="hl-1">.</span><span class="hl-2">os</span><span class="hl-1">+</span><span class="hl-2">arch</span><span class="hl-1">.</span><span class="hl-2">sw</span><span class="hl-1">/&lt;</span><span class="hl-2">os</span><span class="hl-1">&gt;/</span><span class="hl-2">download</span><span class="hl-1">.</span><span class="hl-2">tpl</span>
</code><button>Copy</button></pre>

<p>Again, you can see some examples of partials at use on the <a href="https://github.com/balena-io/contracts/tree/master/contracts/sw.os%2Bhw.device-type/alpine%2Braspberrypi3">balena-io/contracts repository</a>.</p>
<a id="limitations-of-contrato" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Limitations of contrato<a href="#limitations-of-contrato" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Contrato is quite efficient at most tasks it performs, however most of the operations require that the validating context is stored in memory, which puts a limit to the size of the universe. Speed considerations become particularly evident when reproducing a blueprint over a large universe, where the more selectors, the larger the number of combinations and the processing time.</p>
<a id="testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing<a href="#testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Run the <code>test</code> npm script:</p>
<pre><code class="sh"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">test</span>
</code><button type="button">Copy</button></pre>

<a id="contribute" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contribute<a href="#contribute" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>Issue Tracker: <a href="https://github.com/balena-io/contrato/issues">github.com/product-os/contrato/issues</a></li>
<li>Source Code: <a href="https://github.com/balena-io/contrato">github.com/product-os/contrato</a></li>
</ul>
<p>Before submitting a PR, please make sure that you include tests, and that the
linter runs without any warning:</p>
<pre><code class="sh"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">run</span><span class="hl-1"> </span><span class="hl-3">lint</span>
</code><button type="button">Copy</button></pre>

<a id="support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Support<a href="#support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If you're having any problem, please <a href="https://github.com/balena-io/contrato/issues/new">raise an
issue</a> on GitHub.</p>
<a id="license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The project is licensed under the Apache 2.0 license.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#contrato"><span>Contrato</span></a><ul><li><a href="#quickstart"><span>Quickstart</span></a></li><li><a href="#about-contracts"><span>About contracts</span></a></li><li><ul><li><a href="#why-build-this"><span>Why build this?</span></a></li><li><a href="#what-can-be-done-with-contracts"><span>What can be done with contracts?</span></a></li><li><a href="#additional-information"><span>Additional information</span></a></li></ul></li><li><a href="#about-contrato"><span>About contrato</span></a></li><li><ul><li><a href="#contract-validation"><span>Contract validation</span></a></li><li><a href="#contract-templating"><span>Contract templating</span></a></li><li><a href="#universes"><span>Universes</span></a></li><li><a href="#blueprints"><span>Blueprints</span></a></li><li><a href="#templates"><span>Templates</span></a></li><li><a href="#partials"><span>Partials</span></a></li><li><a href="#limitations-of-contrato"><span>Limitations of contrato</span></a></li></ul></li><li><a href="#testing"><span>Testing</span></a></li><li><a href="#contribute"><span>Contribute</span></a></li><li><a href="#support"><span>Support</span></a></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@balena/contrato</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
